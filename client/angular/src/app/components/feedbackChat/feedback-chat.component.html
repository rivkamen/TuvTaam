<div class="chat-layout">

  <!-- 专砖转 砖转 -->
  <div class="session-list">
    <button *ngFor="let s of sessions"
            class="session-item"
            [class.selected]="s._id === selectedSessionId"
            (click)="selectSession(s._id)">
      {{ s.title || (s._id ? '砖 #' + s._id.slice(-4) : '砖  ') }}
    </button>
    <button class="new-session-btn" (click)="startNewSession()">+ 砖 砖</button>
  </div>

  <!-- 转转 爪' -->
  <div class="chat-container">

    <!-- 转转 爪专转 砖 砖 -->
    <div *ngIf="newSessionMode" class="new-session-box">
      <input type="text" [(ngModel)]="newSessionTitle" placeholder="砖 砖 ( )" />
      <textarea [(ngModel)]="newSessionMessage" placeholder="转 转 注 专砖..."></textarea>
      <button (click)="createNewSession()">砖</button>
      <button (click)="cancelNewSession()"></button>
    </div>

    <!-- 注转 拽转 -->
    <div *ngIf="!newSessionMode && selectedSessionId">
      <div *ngIf="loading">注 注转...</div>

      <div class="messages">
        <div *ngFor="let msg of messages"
        
             class="message-wrapper"
             [ngClass]="msg.fromUser ? 'user' : 'admin'">

<div class="bubble">
  <div *ngIf="msg.content">{{ msg.content }}</div>
  <audio *ngIf="msg.signedUrl" [src]="getSafeUrl(msg.signedUrl)" controls></audio>
</div>


          </div>
        </div>
      </div>

    
<div class="message-input-bar">
  <!-- 注 -->
  <input
    type="text"
    [(ngModel)]="newMessage"
    placeholder="转 注..."
    (keydown.enter)="sendMessage()"
  />

  <!-- 专 拽 -->
  <div class="recording-controls">

    <!--  拽 -->
    <ng-container *ngIf="isRecording; else micButton">
      <span class="recording-indicator"> {{ recordingTime | date:'mm:ss' }}</span>
      <button type="button" class="stop-btn" (click)="stopRecording()">
        <i class="pi pi-stop"></i>
      </button>
    </ng-container>

    <!-- 驻转专 拽 (砖专  拽) -->
    <ng-template #micButton>
      <button type="button" class="mic-btn" (click)="startRecording()">
        <i class="pi pi-microphone"></i>
      </button>
    </ng-template>
  </div>

  <!-- 转爪转 拽 ( 拽转) -->
  <div *ngIf="recordedBlob" class="audio-preview">
    <audio [src]="getSafeUrlFromBlob(recordedBlob)" controls></audio>
    <button type="button" (click)="removeRecording()">
      <i class="pi pi-times"></i>
    </button>
  </div>

  <!-- 驻转专 砖 -->
  <button type="button" class="send-btn" (click)="sendMessage()">
    <i class="pi pi-send"></i>
  </button>
</div>

    </div>
  </div>